<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liora Stitching Centre — Feedback</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f9f3f7 0%, #f5eef2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-circle {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin: 0 auto 20px;
            position: relative;
            overflow: hidden;
        }

        .logo-circle::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, transparent 70%);
            border-radius: 50%;
        }

        .main-title {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #8b2e48 0%, #a33a57 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .main-tagline {
            font-size: 18px;
            color: #6b4d52;
            margin-bottom: 10px;
            font-weight: 500;
            letter-spacing: 1px;
        }

        .main-description {
            font-size: 16px;
            color: #8b7a7e;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #d4af37, #8b2e48, #d4af37);
            background-size: 200% 100%;
            animation: shimmer 3s infinite linear;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .brand-section {
            background: linear-gradient(135deg, #f8f2f5 0%, #f4ecf0 100%);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-bottom: 1px solid #f0e6eb;
            border-right: none;
        }

        .brand-title {
            font-size: 24px;
            color: #8b2e48;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .brand-description {
            color: #6b4d52;
            margin-bottom: 25px;
            font-size: 15px;
            line-height: 1.5;
        }

        .brand-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tag {
            background: rgba(139, 46, 72, 0.1);
            color: #8b2e48;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(139, 46, 72, 0.1);
        }

        .form-section {
            padding: 40px;
        }

        .form-title {
            font-size: 26px;
            color: #2b1a1f;
            margin-bottom: 30px;
            font-weight: 700;
            text-align: center;
            position: relative;
        }

        .form-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #d4af37, #8b2e48);
            border-radius: 3px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #3b2a2f;
            font-size: 16px;
        }

        select, input, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #e8e0e5;
            border-radius: 12px;
            font-size: 15px;
            background: #fcfbfc;
            transition: all 0.3s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            background: white;
        }

        /* Work Rating Buttons */
        .work-rating {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .rating-option {
            flex: 1;
            text-align: center;
        }

        .rating-btn {
            width: 100%;
            padding: 16px 10px;
            border: 2px solid #e8e0e5;
            border-radius: 12px;
            background: white;
            font-weight: 600;
            color: #6b4d52;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .rating-btn i {
            font-size: 24px;
            transition: all 0.3s;
        }

        .rating-btn.poor i {
            color: #e74c3c;
        }

        .rating-btn.good i {
            color: #f39c12;
        }

        .rating-btn.perfect i {
            color: #2ecc71;
        }

        .rating-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.1);
        }

        .rating-btn.active {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.05);
            color: #8b2e48;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input {
            width: auto;
        }

        .hint {
            font-size: 13px;
            color: #8b7a7e;
            margin-top: 8px;
        }

        /* Elegant 10-point rating system */
        .satisfaction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .rating-meter {
            background: #fcfbfc;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #f0e6eb;
            transition: all 0.3s;
        }

        .rating-meter:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            transform: translateY(-3px);
        }

        .rating-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .rating-label {
            font-weight: 600;
            color: #3b2a2f;
            font-size: 15px;
        }

        .rating-value {
            font-weight: 700;
            color: #8b2e48;
            font-size: 18px;
            min-width: 30px;
            text-align: center;
            opacity: 0.7;
        }

        .rating-value.has-value {
            opacity: 1;
        }

        .rating-dots {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .rating-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e8e0e5;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .rating-dot:hover {
            transform: scale(1.2);
            background: #d4af37;
        }

        .rating-dot.active {
            background: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
        }

        .rating-scale {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #8b7a7e;
            margin-top: 5px;
        }

        .rating-scale span {
            width: 24px;
            text-align: center;
        }

        .stars {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            justify-content: center;
        }

        .star {
            font-size: 32px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .star:hover {
            transform: scale(1.1);
        }

        .star.active {
            color: #d4af37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .stars-label {
            font-size: 14px;
            color: #6b4d52;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }

        .business-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #f8f2f5 0%, #f4ecf0 100%);
            color: #8b2e48;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            border: 1px solid #e8e0e5;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .business-link:hover {
            background: linear-gradient(135deg, #8b2e48 0%, #a33a57 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 46, 72, 0.2);
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b2e48 0%, #a33a57 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(139, 46, 72, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 46, 72, 0.4);
        }

        .btn-secondary {
            background: #f8f2f5;
            color: #8b2e48;
            border: 1px solid #e8e0e5;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .btn-secondary:hover {
            background: #f0e6eb;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #8b7a7e;
            padding: 15px;
            border-top: 1px solid #f0e6eb;
        }

        .thank-you {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .thank-you.active {
            opacity: 1;
            visibility: visible;
        }

        .thank-you-card {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .thank-you-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #d4af37, #8b2e48, #d4af37);
        }

        .thank-you.active .thank-you-card {
            transform: translateY(0) scale(1);
        }

        .thank-you-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            font-size: 24px;
            font-weight: 700;
            color: #8b2e48;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .thank-you-title {
            font-size: 26px;
            color: #8b2e48;
            margin-bottom: 15px;
        }

        .thank-you-message {
            color: #6b4d52;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .btn-close {
            background: linear-gradient(135deg, #e6b8c6 0%, #d59cae 100%);
            color: #3b1328;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8b2e48;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        @media (max-width: 900px) {
            .card {
                flex-direction: column;
            }
            .brand-section {
                border-bottom: 1px solid #f0e6eb;
                border-right: none;
            }
        }

        @media (max-width: 700px) {
            .satisfaction-grid {
                grid-template-columns: 1fr;
            }
            
            .work-rating {
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .actions {
                flex-direction: column;
            }
            
            .rating-dot {
                width: 20px;
                height: 20px;
            }
            
            .rating-scale span {
                width: 20px;
            }
            
            .main-title {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
           <div class="logo">
                <div class="logo-circle">
                    <img src="https://i.postimg.cc/kg9rvkYn/unnamed.png" alt="Liora Logo" style="width:80px; height:80px; border-radius:90%; object-fit:contain;">
                </div>
           </div>
           <h1 class="main-title">Liora Stitching Centre</h1>
           <div class="main-tagline">Design &bull; Tailoring &bull; Alteration</div>
           <div class="main-description">We value your honest feedback. Help us refine our craft.</div>
        </div>

        <div class="card">
            <div class="form-section">
                <h2 class="form-title">Share Your Feedback</h2>
                
                <form id="feedback-form">
                    <div class="form-group">
                        <label for="service-type">What was the service? <span style="color: #e74c3c;">*</span></label>
                        <select id="service-type" required>
                            <option value="">Select service</option>
                            <option value="Designing + stitching">Designing + stitching</option>
                            <option value="Stitching">Stitching</option>
                            <option value="Alteration">Alteration</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="error-message" id="service-error">Please select a service type</div>
                    </div>

                    <div class="form-group">
                        <label>How was the work? <span style="color: #e74c3c;">*</span></label>
                        <div class="work-rating">
                            <div class="rating-option">
                                <button type="button" class="rating-btn poor" data-value="Poor">
                                    <i class="fas fa-frown"></i>
                                    <span>Poor</span>
                                </button>
                            </div>
                            <div class="rating-option">
                                <button type="button" class="rating-btn good" data-value="Good">
                                    <i class="fas fa-meh"></i>
                                    <span>Good</span>
                                </button>
                            </div>
                            <div class="rating-option">
                                <button type="button" class="rating-btn perfect" data-value="Perfect">
                                    <i class="fas fa-grin-stars"></i>
                                    <span>Perfect</span>
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="work-rating-value" name="work-rating">
                        <div class="error-message" id="work-rating-error">Please rate the work quality</div>

                        <div style="margin-top: 20px;">
                            <label style="font-weight: 700;">Did it meet your preferences exactly? <span style="color: #e74c3c;">*</span></label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="met-yes" name="met-pref" value="Yes">
                                    <label for="met-yes" style="font-weight: normal;">Yes</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="met-no" name="met-pref" value="No">
                                    <label for="met-no" style="font-weight: normal;">No</label>
                                </div>
                            </div>
                            <div class="error-message" id="met-pref-error">Please select if the work met your preferences</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="limitations">If not fully satisfied, what was the limitation?</label>
                        <input type="text" id="limitations" placeholder="Eg: sleeve length, stitching finish, fabric shade...">
                    </div>

                    <div class="form-group">
                        <label>Satisfaction Ratings (Rate from 1-10)</label>
                        <div class="satisfaction-grid">
                            <div class="rating-meter">
                                <div class="rating-header">
                                    <div class="rating-label">Work Satisfaction</div>
                                    <div class="rating-value" id="work-satisfaction-value">-</div>
                                </div>
                                <div class="rating-dots" id="work-satisfaction-dots">
                                    <!-- Dots will be generated by JavaScript -->
                                </div>
                                <div class="rating-scale">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                            </div>
                            
                            <div class="rating-meter">
                                <div class="rating-header">
                                    <div class="rating-label">Behaviour</div>
                                    <div class="rating-value" id="behaviour-value">-</div>
                                </div>
                                <div class="rating-dots" id="behaviour-dots">
                                    <!-- Dots will be generated by JavaScript -->
                                </div>
                                <div class="rating-scale">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                            </div>
                            
                            <div class="rating-meter">
                                <div class="rating-header">
                                    <div class="rating-label">Understanding</div>
                                    <div class="rating-value" id="understanding-value">-</div>
                                </div>
                                <div class="rating-dots" id="understanding-dots">
                                    <!-- Dots will be generated by JavaScript -->
                                </div>
                                <div class="rating-scale">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                            </div>
                            
                            <div class="rating-meter">
                                <div class="rating-header">
                                    <div class="rating-label">Readiness to Help</div>
                                    <div class="rating-value" id="readiness-value">-</div>
                                </div>
                                <div class="rating-dots" id="readiness-dots">
                                    <!-- Dots will be generated by JavaScript -->
                                </div>
                                <div class="rating-scale">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Overall rating</label>
                        <div class="stars">
                            <div class="star" data-value="1"><i class="fas fa-star"></i></div>
                            <div class="star" data-value="2"><i class="fas fa-star"></i></div>
                            <div class="star" data-value="3"><i class="fas fa-star"></i></div>
                            <div class="star" data-value="4"><i class="fas fa-star"></i></div>
                            <div class="star" data-value="5"><i class="fas fa-star"></i></div>
                        </div>
                        <div class="stars-label" id="stars-label">Click stars to rate</div>
                    </div>

                    <div class="form-group">
                        <label for="suggestions">Your suggestions / feedback (we read every message)</label>
                        <textarea id="suggestions" placeholder="Tell us anything — improvements, praise or ideas..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Find / Review us</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                            <a href="https://g.page/r/CbQ8Z3y9t2G-EAI/review" class="business-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                Google Business profile
                            </a>
                            <div class="hint">Visit our Google Business profile to leave a public review</div>
                        </div>
                    </div>

                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>Submitting your feedback...</p>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Submit Feedback
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-btn">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>

                <div class="footer">
                    <small>Thank you for choosing <strong>Liora Stitching Centre</strong>. Your feedback is private and used only to improve our service.</small>
                </div>
            </div>
        </div>
    </div>

    <div class="thank-you" id="thank-you">
        <div class="thank-you-card">
            <div class="thank-you-logo">LIORA</div>
            <h2 class="thank-you-title">Warm thanks from Liora Stitching Centre</h2>
            <p class="thank-you-message">We sincerely appreciate your time — your feedback helps us craft better garments and better experiences.</p>
            <button class="btn-close" id="close-thank-you">Close</button>
        </div>
    </div>

    <script>
        // ✅ CORRECT Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdHa-kBJv-SeCKDQgaj_poXe6ZRy_ZCuU",
            authDomain: "liora-stitching-feedback.firebaseapp.com",
            projectId: "liora-stitching-feedback",
            storageBucket: "liora-stitching-feedback.firebasestorage.app",
            messagingSenderId: "441953355513",
            appId: "1:441953355513:web:da10f6c576cb975c6f8428"
        };

        // Initialize Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("✅ Firebase initialized successfully with liora-stitching-feedback");
        } catch (error) {
            console.error("❌ Firebase initialization error:", error);
        }

        // Work rating buttons
        const ratingButtons = document.querySelectorAll('.rating-btn');
        const workRatingValue = document.getElementById('work-rating-value');
        
        ratingButtons.forEach(button => {
            button.addEventListener('click', function() {
                ratingButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                workRatingValue.value = this.dataset.value;
                document.getElementById('work-rating-error').style.display = 'none';
            });
        });

        // 10-point rating system
        function createRatingDots(containerId, valueId) {
            const container = document.getElementById(containerId);
            const valueDisplay = document.getElementById(valueId);
            
            container.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const dot = document.createElement('div');
                dot.className = 'rating-dot';
                dot.dataset.value = i;
                
                dot.addEventListener('click', function() {
                    const value = parseInt(this.dataset.value);
                    const allDots = container.querySelectorAll('.rating-dot');
                    allDots.forEach(d => {
                        if (parseInt(d.dataset.value) <= value) {
                            d.classList.add('active');
                        } else {
                            d.classList.remove('active');
                        }
                    });
                    valueDisplay.textContent = value;
                    valueDisplay.classList.add('has-value');
                });
                
                container.appendChild(dot);
            }
            
            valueDisplay.textContent = '-';
            valueDisplay.classList.remove('has-value');
        }

        // Initialize all rating meters
        createRatingDots('work-satisfaction-dots', 'work-satisfaction-value');
        createRatingDots('behaviour-dots', 'behaviour-value');
        createRatingDots('understanding-dots', 'understanding-value');
        createRatingDots('readiness-dots', 'readiness-value');

        // Star rating
        const stars = document.querySelectorAll('.star');
        const starsLabel = document.getElementById('stars-label');
        let currentRating = 0;

        stars.forEach(star => {
            star.addEventListener('click', function() {
                const value = parseInt(this.getAttribute('data-value'));
                currentRating = value;
                
                stars.forEach(s => {
                    if (parseInt(s.getAttribute('data-value')) <= value) {
                        s.classList.add('active');
                    } else {
                        s.classList.remove('active');
                    }
                });
                
                starsLabel.textContent = value + ' / 5';
            });
            
            star.addEventListener('mouseover', function() {
                const value = parseInt(this.getAttribute('data-value'));
                stars.forEach(s => {
                    if (parseInt(s.getAttribute('data-value')) <= value) {
                        s.style.color = '#d4af37';
                    } else {
                        s.style.color = '#e0e0e0';
                    }
                });
            });
            
            star.addEventListener('mouseout', function() {
                stars.forEach(s => {
                    if (parseInt(s.getAttribute('data-value')) > currentRating) {
                        s.style.color = '#e0e0e0';
                    }
                });
            });
        });

        // Form validation
        function validateForm() {
            let isValid = true;
            
            const serviceType = document.getElementById('service-type').value;
            if (!serviceType) {
                document.getElementById('service-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('service-error').style.display = 'none';
            }
            
            if (!workRatingValue.value) {
                document.getElementById('work-rating-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('work-rating-error').style.display = 'none';
            }
            
            const metPref = document.querySelector('input[name="met-pref"]:checked');
            if (!metPref) {
                document.getElementById('met-pref-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('met-pref-error').style.display = 'none';
            }
            
            return isValid;
        }

        // Form submission
        const form = document.getElementById('feedback-form');
        const thankYou = document.getElementById('thank-you');
        const resetBtn = document.getElementById('reset-btn');
        const closeThankYou = document.getElementById('close-thank-you');
        const loading = document.getElementById('loading');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log("Form submission started...");
            
            // Validate form
            if (!validateForm()) {
                console.log("Form validation failed");
                return;
            }
            
            // Show loading indicator
            loading.style.display = 'block';
            console.log("Loading indicator shown");
            
            // Collect all form data
            const formData = {
                service: document.getElementById('service-type').value,
                workRating: workRatingValue.value,
                metPref: document.querySelector('input[name="met-pref"]:checked').value,
                limitations: document.getElementById('limitations').value,
                workSatisfaction: document.getElementById('work-satisfaction-value').textContent,
                behaviour: document.getElementById('behaviour-value').textContent,
                understanding: document.getElementById('understanding-value').textContent,
                readiness: document.getElementById('readiness-value').textContent,
                overallRating: currentRating,
                suggestions: document.getElementById('suggestions').value,
                timestamp: new Date()
            };
            
            console.log("Form data prepared:", formData);
            
            try {
                // Add timeout to prevent infinite loading
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Request timeout after 10 seconds')), 10000);
                });
                
                console.log("Attempting to save to Firebase...");
                
                // Check if db is initialized
                if (!db) {
                    throw new Error('Firebase not initialized');
                }
                
                const savePromise = db.collection('feedback').add(formData);
                
                // Race between save operation and timeout
                await Promise.race([savePromise, timeoutPromise]);
                
                console.log("Successfully saved to Firebase!");
                
                // Hide loading indicator
                loading.style.display = 'none';
                
                // Show thank you message
                thankYou.classList.add('active');
                
                // Reset form
                resetForm();
                
            } catch (error) {
                console.error('Submission error:', error);
                loading.style.display = 'none';
                
                if (error.message === 'Request timeout after 10 seconds') {
                    alert('Request timed out. Please check your internet connection and try again.');
                } else {
                    alert('Failed to submit feedback. Error: ' + error.message + '\n\nPlease check your Firebase configuration.');
                }
            }
        });

        function resetForm() {
            form.reset();
            
            // Reset rating buttons
            ratingButtons.forEach(btn => btn.classList.remove('active'));
            workRatingValue.value = '';
            
            // Reset 10-point ratings
            createRatingDots('work-satisfaction-dots', 'work-satisfaction-value');
            createRatingDots('behaviour-dots', 'behaviour-value');
            createRatingDots('understanding-dots', 'understanding-value');
            createRatingDots('readiness-dots', 'readiness-value');
            
            // Reset star rating
            stars.forEach(star => {
                star.classList.remove('active');
                star.style.color = '#e0e0e0';
            });
            currentRating = 0;
            starsLabel.textContent = 'Click stars to rate';
            
            // Hide error messages
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
            
            console.log("Form reset completed");
        }

        resetBtn.addEventListener('click', resetForm);
        closeThankYou.addEventListener('click', function() {
            thankYou.classList.remove('active');
        });

        // Test Firebase connection on load
        window.addEventListener('load', function() {
            console.log("Page loaded, testing Firebase connection...");
            
            if (db) {
                // Simple test to see if Firebase is working
                const testDoc = db.collection('test').doc('connection-test');
                testDoc.set({
                    test: 'Connection test',
                    timestamp: new Date()
                }).then(() => {
                    console.log("✅ Firebase connection test: SUCCESS");
                }).catch(error => {
                    console.error("❌ Firebase connection test: FAILED", error);
                });
            } else {
                console.error("❌ Firebase not initialized - check configuration");
            }
        });
    </script>
</body>
</html>